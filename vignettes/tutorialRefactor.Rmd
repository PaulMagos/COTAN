The purpose of this tutorial is to demonstrate the use 
of the `COTAN` framework refactor

In this example a dataset was used for which the clusters with which to group 
the cells were already known
```{r}
yoc <- readRDS('/home/putty05/data/youngOld.RDS')
```

import all source files from /core, a temporarily separate directory 
from the rest of the code
```{r}
options(warn=-1)
setwd("/home/putty05/COTAN/core/")
options(warn=0)

# list of all source files
sourceFiles <- list.files(path = ".", pattern = "*.R", all.files = TRUE)

# invisible() suppress the output of sapply
invisible(sapply(sourceFiles, source)) 
```

creation of the `COTAN` object and initialization of the initial parameters
```{r}
# Log-level 2 was chosen to showcase better how the package works
# In normal usage a level of 0 or 1 is more appropriate 
setLoggingLevel(2)

objCOTAN <- COTAN(raw=yoc@raw)

objCOTAN <- estimateLambdaLinear(objCOTAN)
objCOTAN <- estimateNuLinear(objCOTAN) 
objCOTAN <- estimateRawNorm(objCOTAN)
muEst    <- calculateMu(objCOTAN)
```

[PART A] Estimation by bisection of the 'dispersion' parameter
```{r}
startTime <- Sys.time()

objCOTAN <- findHousekeepingGenes(objCOTAN)
objCOTAN <- estimateDispersionBisection(objCOTAN, cores = 8)

endTime <- Sys.time()
logThis(endTime - startTime, logLevel = 0)
```

[PART B]Estimation by bisection of the 'nu' parameter
```{r}
startTime <- Sys.time()

objCOTAN <- findFullyExpressedCells(objCOTAN)
objCOTAN <- estimateNuBisection(objCOTAN)

endTime <- Sys.time()
logThis(endTime - startTime, logLevel = 0)
```
To converge, the 'dispersion' nu 'parameters must be estimated by bisection 
twice: execute [PART A] and PART[B] twice

obtain the coex matrix for the cells
```{r}
startTime <- Sys.time()

objCOTAN <- calculateCoex(objCOTAN, cells = TRUE)

endTime <- Sys.time()
logThis(endTime - startTime, logLevel = 0)
```

Coex heatmap for clustered cells

```{r}
# names(yoc@clusters) contains the cell names
plotCellsHeatmap(objCOTAN, clusters = yoc@clusters)
```

